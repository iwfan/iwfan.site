---
title: å‡½æ•°å¼ç¼–ç¨‹å…¥ä¸äº†é—¨
slug: fe2c9320b726a71bfc532e185f580dba
date: 2020-05-23 08:00:00
tags:
  - Functional Programming
thumbnail: null
---

![Untitled.png](./assets/fp-0.png)

# What is it and why use itï¼Ÿ

å‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ç§é€šè¿‡åº”ç”¨ä¸ç»„åˆå‡½æ•°æ¥æ„é€ ç¨‹åºçš„ç¼–ç¨‹èŒƒå¼ã€‚

å‡½æ•°å¼çš„ç‰¹ç‚¹ï¼š**å£°æ˜å¼**ã€ä»¥å‡½æ•°ä½¿ç”¨ä¸ºä¸», æå€¡ä½¿ç”¨çº¯å‡½æ•°ã€æ¶ˆé™¤å‰¯ä½œç”¨å’Œå‡å°‘çŠ¶æ€ä¿®æ”¹ã€‚

**å‡½æ•°å¼ç¼–ç¨‹æ€ç»´å…³å¿ƒæ•°æ®çš„æ˜ å°„ï¼Œå‘½ä»¤å¼(imperative)ç¼–ç¨‹å…³å¿ƒè§£å†³é—®é¢˜çš„æ­¥éª¤ã€‚**

ä»¥é•œåƒç¿»è½¬äºŒå‰æ ‘çš„ä»£ç ä¸ºä¾‹ï¼š

```jsx
// ä»¥ä¸‹ä»£ç æè¿°äº†ç¿»è½¬äºŒå‰æ ‘çš„è¿‡ç¨‹
function invertTree(node) {
  if (node == null) return null

  node.left = invertTree(node.right)
  node.right = invertTree(node.left)

  return node
}
```

```jsx
// ä»¥ä¸‹ä»£ç ä½“ç°äº†å¦‚ä½•ä»æ—§æ ‘å¾—åˆ°ä¸€é¢—æ–°æ ‘
const invertTree = (node) => {
  return node == null
    ? null
    : new Tree(node.value, invertTree(node.right), invertTree(node.left))
}
```

ä¸‹é¢çš„ä»£ç ä½“ç°çš„æ˜¯å¦‚ä½•ä»ä¸€é¢—æ—§æ ‘å¾—åˆ°ä¸€é¢—æ–°æ ‘ï¼Œç›®çš„æ€§éå¸¸æ˜ç¡®ï¼ˆæˆ‘è¦ä¸€æ£µæ ‘ï¼‰ã€‚è€Œä¸Šé¢çš„ä»£ç è¡¨ç¤ºçš„æ˜¯ç¿»è½¬æ ‘çš„è¿‡ç¨‹ï¼Œé€šè¿‡æè¿°ã€Œä»æ—§æ ‘å¾—åˆ°æ–°æ ‘åº”è¯¥æ€æ ·åšã€æ¥è¾¾åˆ°ç›®çš„ã€‚

æŒ‡ä»¤å¼çš„ä»£ç æ›´é€‚åˆæœºå™¨è¿è¡Œï¼Œå› ä¸ºåœ¨ç¼–å†™ä¸€æ¡æ¡çš„æŒ‡ä»¤æ—¶å¾ˆå®¹æ˜“å¤±ç„¦ï¼Œå¿˜è®°äº†çœŸæ­£çš„ç›®çš„ã€‚è€Œå£°æ˜å¼çš„ä»£ç æ›´æŠ½è±¡ã€æ›´é€‚åˆäººç±»é˜…è¯»ã€‚

|     | ä¼˜åŠ¿                                   | ç¼ºé™·                 |
| :-- | :------------------------------------- | :------------------- |
| 1   | å£°æ˜å¼ç¼–ç¨‹ï¼Œä¸æ‹˜æ³¥äºç»†èŠ‚ï¼Œä»£ç æ›´æ¸…æ™°   | è¾ƒéš¾å­¦ä¹ ä¸ä¸Šæ‰‹       |
| 2   | çº¯å‡½æ•°èŒè´£æ›´å°ï¼Œåˆ©äºæµ‹è¯•ä¸ç»´æŠ¤         | éœ€è¦æ›´é«˜å±‚çš„æŠ½è±¡æ€ç»´ |
| 3   | é¼“åŠ±å¤æ‚ä»»åŠ¡çš„åˆ†è§£ï¼Œä»£ç å¯é‡ç”¨ç¨‹åº¦å˜é«˜ |                      |

## Purity

**çº¯å‡½æ•°**ï¼šå‡½æ•°çš„è¾“å‡ºä»…ç”±è¾“å…¥å†³å®šï¼Œä¸ä¼šé€ æˆè¶…å‡ºå…¶å‰¯ä½œç”¨çš„å˜åŒ–ã€‚æœ‰åŠ©äºæé«˜ä»£ç çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

```jsx
const greet = (name) => `Hi, ${name}`

greet('Brianne') // 'Hi, Brianne'
```

```jsx
window.name = 'Brianne'

const greet = () => `Hi, ${window.name}`

greet() // "Hi, Brianne"
```

```jsx
let greeting

const greet = (name) => {
  greeting = `Hi, ${name}`
}

greet('Brianne')
greeting // "Hi, Brianne"
```

```jsx
Date.now() // ?
Math.random() // ?
```

ä¸å½“å‰å‡½æ•°ä½œç”¨åŸŸå¤–äº§ç”Ÿäº¤äº’çš„ä»£ç éƒ½æ˜¯æœ‰ä½œç”¨çš„ï¼Œéƒ½ä¸æ˜¯çº¯å‡½æ•°ã€‚

### Referential Transparency

```jsx
multiply(sum(1, 2),sum(1, 3)) // -> 12

// å‡½æ•°çš„è°ƒç”¨å¯ä»¥ç›´æ¥è¢«è¿”å›å€¼æ›¿æ¢

multiply(3, 4)) // -> 12

```

## HOFâ—ï¸â—ï¸â—ï¸

JS ä¸­å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œå¯ä»¥åƒå…¶ä»–çš„å˜é‡ä¸€æ ·è¢«ä¼ é€’ã€‚

```jsx
map / filter / reduce

map(v -> v)
filter(v -> !v)

[1].map(1) = [2]
[1].map(() => 2) [3]
```

è¿™ä½¿å¾—å‡½æ•°æœ‰äº† IoC(Inversion of control) çš„èƒ½åŠ›ã€‚

## Immutable data

çº¯å‡½æ•°ä¼šä½¿ä»£ç æ›´å®¹æ˜“ç»´æŠ¤ï¼Œä½†æ˜¯å´æ²¡æœ‰â€œçº¯å¯¹è±¡â€è¿™ç§ä¸œè¥¿ï¼Œç¨‹åºä¸­çš„çŠ¶æ€æ˜¯ä¸€ç›´å¯å˜çš„ã€‚ä¸ºäº†è®©çŠ¶æ€æ›´å®¹æ˜“ç®¡ç†ï¼Œå‡½æ•°å¼ç¼–ç¨‹æ¨èä½¿ç”¨ä¸å¯å˜æ•°æ®ã€‚

```jsx
// number / string / boolean éƒ½æ˜¯ä¸å¯å˜æ•°æ®
let str = 'functional programming'
// è¿”å›æ–°çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯å¯¹æ—§çŠ¶æ€çš„ä¿®æ”¹
str = 'declarative programming'

let arr = [1]

arr[2] = ''
```

1. Object.freeze - åªæ˜¯æµ…å†»ç»“, æ›´æ·±å±‚çš„å†»ç»“éœ€è¦é€’å½’æŸ¥æ‰¾è€—æŸæ€§èƒ½

   ![Untitled%201.png](./assets/fp-1.png)

2. CoW - ä¸æ–­å¤åˆ¶é€ æˆæ€§èƒ½æŸè€—

   [Copy-on-write](https://en.wikipedia.org/wiki/Copy-on-write)

   Lenses

   ```jsx
   interface Lens<S, A> {
     get(s: S): A;
     set(a: A, s: S): S;
   }

   const address: Lens<Address, Street> = {
     get: (address) => address.street,
     set: (street, address) => ({ ...address, street }),
   }

   address.get(a1)
   // => {num: 23, name: "high street"}
   address.set({ num: 23, name: 'main street' }, a1)
   // => {city: "london", street: {num: 23, name: "main street"}}
   ```

   [Introduction to optics: lenses and prisms](https://medium.com/@gcanti/introduction-to-optics-lenses-and-prisms-3230e73bfcfe)

3. Structure Sharing

   ![https://image.slidesharecdn.com/euroclojure-1-150625130806-lva1-app6891/95/a-deep-dive-into-clojures-data-structures-euroclojure-2015-15-638.jpg?cb=1435237981](https://image.slidesharecdn.com/euroclojure-1-150625130806-lva1-app6891/95/a-deep-dive-into-clojures-data-structures-euroclojure-2015-15-638.jpg?cb=1435237981)

   [Persistent data structure](https://en.wikipedia.org/wiki/Persistent_data_structure)

   JavaScript ä¸­æ”¯æŒ Structure Sharing çš„å·¥å…·ï¼š

   [immerjs/immer](https://github.com/immerjs/immer)

   [Immutable.js](https://immutable-js.github.io/immutable-js/)

# Currying

currying çš„æ¦‚å¿µå¾ˆç®€å•ï¼šå¯¹äºå¤šå½¢å‚çš„å‡½æ•°ï¼Œè°ƒç”¨æ—¶åªä¼ é€’ç»™å®ƒä¸€éƒ¨åˆ†å‚æ•°ï¼Œè®©å®ƒè¿”å›ä¸€ä¸ªå‡½æ•°å»å¤„ç†å‰©ä¸‹çš„å‚æ•°ã€‚

æŸ¯é‡ŒåŒ–æå¤§ç¨‹åº¦çš„æé«˜äº†ä»£ç çš„å¯å¤ç”¨æ€§ã€‚

```jsx
const add = function (x) {
  return function (y) {
    return x + y
  }
}

add = (x, y) => x + y

var increment = add(1)
var addTen = add(10)

increment(2)
// 3

addTen(2)
// 12
```

# Combinators

ä¸Šé¢çš„éƒ½æ˜¯åœ¨è®²å¦‚ä½•â€œæ‹†å‡½æ•°â€ï¼Œå‡½æ•°å¼ç¼–ç¨‹å°†å‡½æ•°è§†ä¸ºç§¯æœ¨ï¼Œé€šè¿‡å‡½æ•°ç»„åˆå­å¯ä»¥å°†ç‹¬ç«‹çš„å‡½æ•°ä»¥ä¸åŒçš„æ–¹å¼ç»„åˆèµ·æ¥ã€‚

composeï¼ˆRedux / Chain of Responsibilityï¼‰

```jsx
compose(fc, fb, fa)('arg') = fc(fb(fa('arg')))
```

pipe

```jsx
pipe(fa, fb, fc) = fc(fb(fa('arg')))
```

tap

```jsx
// tap :: (x -> *) -> x -> x
tap((x) => {
  /* do anything */
})(x) === x
```

seq

```jsx
seq(fa, fb, fc)(x) === x
```

alt

```jsx
alt(returnFalse, returnOther)(x)

{
  const returnValue = returnFalse(x)

  return returnValue || returnOther(x)
}
```

forkJoin

```jsx
fork(last, f1, f2)(x)

{
  const r1 = f1(x),
    r2 = f2(x)

  return last(r1, r2)
}
```

## Side-effect

å‰¯ä½œç”¨å¸¦æ¥çš„é—®é¢˜æ˜¯ä¸å¯é¢„è§çš„ã€‚æ‰€ä»¥åœ¨å†™å‡½æ•°å¼çš„ä»£ç æ—¶ï¼Œè¦æœ‰æ„åŒºåˆ†çº¯çš„ä¸ä¸çº¯çš„ä»£ç ã€‚

[https://inews.gtimg.com/newsapp_bt/0/10524648136/1000](https://inews.gtimg.com/newsapp_bt/0/10524648136/1000)

[https://img3.doubanio.com/view/photo/l/public/p2589766490.webp](https://img3.doubanio.com/view/photo/l/public/p2589766490.webp)

[è®¡ç®—æœºç§‘å­¦ä¸­çš„æœ€ä¸¥é‡é”™è¯¯ï¼Œé€ æˆåäº¿ç¾å…ƒæŸå¤±](https://www.techug.com/post/serious-loss.html)

null æ˜¯ä¸€ä¸ªä»·å€¼æ•°åäº¿ç¾é‡‘çš„é”™è¯¯

![Untitled%202.png](./assets/fp-2.png)

Error / Exception

ç¼ºç‚¹ï¼š

1. éš¾ä»¥ä¸å…¶ä»–å‡½æ•°ç»„åˆä¸é“¾æ¥
2. ä¼šå¼•èµ·å‰¯ä½œç”¨
3. ä¸èƒ½åªå…³æ³¨å‡½æ•°çš„è¿”å›å€¼ï¼Œè¿˜éœ€è¦è´Ÿè´£å¼‚å¸¸çš„å¤„ç†
4. å¤šä¸ªå¼‚å¸¸æ—¶ä¼šå‡ºç°åµŒå¥—çš„ try ... catch..

æŠŠ å‰¯ä½œç”¨ å…³èµ·æ¥

[https://img1.doubanio.com/view/photo/l/public/p2589766489.webp](https://img1.doubanio.com/view/photo/l/public/p2589766489.webp)

### å®¹å™¨

![Untitled%203.png](./assets/fp-3.png)

### Functor â†’ å¯¹æ“ä½œå®¹å™¨å†…æ•°æ®è¡Œä¸ºçš„æŠ½è±¡

![Untitled%204.png](./assets/fp-4.png)

1. Functor å¿…é¡»æ˜¯æ— å‰¯ä½œç”¨çš„

   ```jsx
   new Functor('x').map((v) => v) // -> Functor('x')
   ```

2. å¿…é¡»å¯ä»¥ä¸å…¶ä»–å‡½æ•°ç»„åˆ

   ```jsx
   new Functor(2).map(pipe(plus3, tap(log))) // -> Functor('5')
   ```

JS ä¸­ Array å°±æ˜¯ä¸€ä¸ª Functorã€‚

![Untitled%205.png](./assets/fp-5.png)

### Monad

> Monad æ˜¯è‡ªå‡½å­èŒƒç•´ä¸Šçš„çš„ä¸€ä¸ªå¹ºåŠç¾¤ã€‚ğŸ¤¦â€â™€ï¸ğŸ¤¦â€â™‚ï¸ğŸ¤¦ ï¼ˆè¿™æ˜¯äººè¯ï¼Ÿ

![Untitled%206.png](./assets/fp-6.png)

Monad æ˜¯ä¸€ä¸ªæŠ½è±¡æ¥å£ï¼Œä»£è¡¨å…·æœ‰ä¸€å®šè§„åˆ™çš„å®¹å™¨ã€‚Monad æ˜¯å¯ä»¥å˜æ‰ï¼ˆflattenï¼‰çš„ pointed functorã€‚

1. of å‡½æ•°ï¼Œå¯ä»¥å°†å€¼å­˜å…¥å®¹å™¨ä¸­
2. map å‡½æ•°ï¼Œä¸å®¹å™¨å†…çš„å€¼äº¤äº’
3. joinï¼ˆflattenï¼‰ï¼Œå°†åµŒå¥—çš„å®¹å™¨æ‹æ‰
4. chainï¼Œç»„åˆäº† map ä¸ join

Promise æ˜¯ä¸æ˜¯ä¸€ä¸ª Monad ï¼Ÿ Array æ˜¯ä¸æ˜¯ä¸€ä¸ª Monad ï¼Ÿ

![Untitled%207.png](./assets/fp-7.png)

# ä¼˜åŒ–

> ä¸ºä»€ä¹ˆâ€œå‡½æ•°å¼ç¼–ç¨‹éƒ½æ˜¯åƒåœ¾â€ï¼Ÿ

## ä½¿ç”¨å‡½æ•°ç»„åˆå­é¿å…ä¸å¿…è¦çš„è®¡ç®—

```jsx
const showStudent = pipe(
  alt(findStudent, createNewStudent),
  append('#student-info')
)
```

## ğŸ¤·â€â™‚ï¸ğŸ¤·â€â™‚ï¸ğŸ¤·â€â™‚ï¸ shortcut fusion é’ˆå¯¹äºå‡½æ•°å¼é“¾çš„ä¼˜åŒ–

```jsx
const _ = require('lodash')
const { compose, tap } = require('ramda')

const square = compose(
  (x) => Math.pow(x, 2),
  tap((a) => console.log('square', a))
)

const isEven = compose(
  tap(() => console.log('even')),
  (x) => x % 2 === 0
)

const numbers = _.range(200)
console.log(numbers)
const result = _.chain(numbers).map(square).filter(isEven).take(3).value()

console.log(result)
```

## é¿å…è¿‡å¤šå±‚çº§çš„ currying

![Untitled%208.png](./assets/fp-8.png)

ä½¿ç”¨ partial(bind) æ›¿ä»£ curry

è¿‡å¤šçš„æŸ¯é‡ŒåŒ–ä¼šä½¿å¾—è°ƒç”¨å †æ ˆæš´æ¶¨ï¼Œä¼šå ç”¨æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚

# éš¾ç‚¹

1. FP ç®—æ˜¯ä¸€é—¨å†å²æ‚ ä¹…çš„å­¦ç§‘ï¼Œå®ƒå§‹äºæ•°å­¦å®¶çš„ lambda æ¼”ç®—ï¼Œä¸€å¼€å§‹å°±ä¸æ•°å­¦ï¼ˆèŒƒç•´è®ºï¼‰å¯†ä¸å¯åˆ†ï¼Œä¸€å¼€å§‹å­¦ä¹ ä¼šæœ‰ç‰¹åˆ«å¤šçš„æ¦‚å¿µä¸æ¸…æ™°ã€‚
2. å°±ç®—æœ‰äº†äº›ç†è®ºåŸºç¡€ï¼Œä¸€å¼€å§‹å®é™…åŠ¨æ‰‹å†™ FP ä»£ç æ—¶ï¼Œè¿˜æ²¡æœ‰å½¢æˆå‡½æ•°å¼æ€ç»´ï¼Œä¹Ÿæ¯”è¾ƒå›°éš¾ï¼Œå¯èƒ½è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ lisp ä¸ haskell ç­‰è¯­è¨€ç«ä¸èµ·æ¥çš„åŸå› å§ã€‚
3. åƒä¸‡ä¸è¦è¢«æ•™æ¡æŸç¼šï¼ŒFP ä¸ OO å¹¶ä¸æ˜¯éæ­¤å³å½¼çš„å…³ç³»ï¼Œä»–ä»¬å¯ä»¥ç›¸è¾…ç›¸æˆã€‚æœ€é‡è¦çš„æ˜¯æˆ‘ä»¬è¦çŸ¥é“æˆ‘ä»¬å†™çš„æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬ä»£ç åœ¨å“ªé‡Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Ÿ

ä¾‹å¦‚è¯´ï¼šFP ä¸æ˜¯å‡½æ•°å¼å—ï¼Ÿ é‚£æˆ‘çš„ä»£ç é‡Œå°±ä¸èƒ½æœ‰ classã€‚ FP ä¸æ˜¯ä¸æ”¯æŒä¿®æ”¹çŠ¶æ€å—ï¼Ÿé‚£æˆ‘å°±ä¸èµ‹å€¼ã€‚åªé€’å½’ä¸å¾ªç¯ã€‚

    > OO é€šè¿‡å°è£…å˜åŒ–ä½¿å¾—ä»£ç æ›´å®¹æ˜“ç†è§£
    FP é€šè¿‡æœ€å°åŒ–å˜åŒ–ä½¿å¾—ä»£ç æ›´å®¹æ˜“ç†è§£

    **ä½ å¯ä»¥æŠŠå‰¯ä½œç”¨å…³èµ·æ¥ï¼Œä½†ä¸è¦ç»™è‡ªå·±çš„æ€æƒ³è®¾é™ã€‚**

[https://img1.doubanio.com/view/photo/l/public/p2583893058.webp](https://img1.doubanio.com/view/photo/l/public/p2583893058.webp)

# å‚è€ƒèµ„æ–™

[ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç¼–ç¨‹æ€ç»´ï¼Ÿ](https://www.zhihu.com/question/28292740/answer/100284611)

[Three Useful Monads](http://adit.io/posts/2013-06-10-three-useful-monads.html)

[å›¾è§£ Functor, Applicative å’Œ Monad](http://blog.forec.cn/2017/03/02/translation-adit-faamip/)

[ä¸‰ç§å®ç”¨ Monad](http://blog.forec.cn/2017/03/02/translation-adit-tum/)

- é˜®è€å¸ˆçš„å…¥é—¨æ•™ç¨‹ï¼š[å‡½æ•°å¼ç¼–ç¨‹å…¥é—¨æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—](https://www.ruanyifeng.com/blog/2017/02/fp-tutorial.html)
- å‡½æ•°å¼ç¼–ç¨‹æŒ‡å—ï¼š [Functional Programming in JavaScript](https://drive.google.com/open?id=1j1IUHjiKYs3WSzgYQT294Eyro9JosoXT)
- å‡½æ•°å¼ç¼–ç¨‹å‘å¯¼ï¼š[mostly-adequate-guide](https://github.com/MostlyAdequate/mostly-adequate-guide)
- FP è§„èŒƒæŒ‡å—ï¼š[Fantasy Land JavaScript specification Guide](https://sanderv1992.github.io/fp/)
- å‡½æ•°å¼ç¼–ç¨‹æœ¯è¯­é›†ï¼š[functional programming-jargon](https://github.com/hemanth/functional-programming-jargon)
- è½®å­å“¥æ¨èçš„ FP æ•™ç¨‹ï¼š[åè‘—ç±» - ajoo - BlogJava](http://www.blogjava.net/ajoo/category/6968.html)
- Github FP topicï¼š [functional-programming Â· GitHub Topics Â· GitHub](https://github.com/topics/functional-programming)
- å…³äº lambda æ¼”ç®—ï¼š[https://cgnail.github.io/academic/lambda-1/](https://cgnail.github.io/academic/lambda-1/)
