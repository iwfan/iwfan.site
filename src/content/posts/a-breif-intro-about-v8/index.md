---
title: V8 å¼•æ“äº”é—®
emoji: ğŸš€
created_at: "2024-09-24"
---

#### ç¬¬ä¸€é—®ï¼šChromium æµè§ˆå™¨æ˜¯å¦‚ä½•ä¸ V8 å¼•æ“é…åˆè§£æå¹¶æ‰§è¡Œ JavaScript ä»£ç çš„ï¼Ÿ

1. åŸºäº Chromium çš„æµè§ˆå™¨å†…éƒ¨é›†æˆäº† V8 å¼•æ“ï¼Œå¹¶ç»™ V8 å¼•æ“æä¾›äº†ä¸€ä¸ªå®‰å…¨çš„æ‰§è¡Œç¯å¢ƒï¼Œæµè§ˆå™¨åœ¨è§£æ Script æ ‡ç­¾ã€åŠ è½½ JavaScript è„šæœ¬ä»£ç æ—¶ï¼Œä¼šå°† JavaScript ä»£ç äº¤ç»™ V8 å¼•æ“æ¥æ‰§è¡Œã€‚
2. æµè§ˆå™¨ä¹Ÿæä¾›äº†ç»™ JavaScript è°ƒç”¨çš„ WEB APIï¼Œ ä¾‹å¦‚ DOM APIã€Storage APIã€Location API ç­‰ç­‰ï¼Œ V8 å¼•æ“ä¼šé€šè¿‡è¿™äº› API ä¸æµè§ˆå™¨äº¤äº’ã€‚
3. æµè§ˆå™¨å†…éƒ¨ä¼šç»´æŠ¤ä¸€ä¸ªç”±ä¸¤ä¸ªä»»åŠ¡é˜Ÿåˆ—ç»„æˆçš„äº‹ä»¶å¾ªç¯ï¼Œç”¨äºå¤„ç†å¼‚æ­¥ä»»åŠ¡ä»¥åŠå›è°ƒå‡½æ•°ï¼Œå½“ V8 å¼•æ“ä¸­çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¼šæ‰§è¡Œäº‹ä»¶å¾ªç¯ä¸­çš„ä»»åŠ¡ã€‚

#### ç¬¬äºŒé—®ï¼šV8 å¼•æ“çš„å…³é”®ç»„ä»¶éƒ½æœ‰å“ªäº›ï¼Ÿä»–ä»¬æ˜¯å¦‚ä½•å…±åŒå®Œæˆä»»åŠ¡çš„ï¼Ÿ

![v8 overview](https://v8.dev/_img/scanner/overview.svg)

V8 æ‰§è¡Œ JavaScript çš„å…³é”®éƒ¨ä»¶æœ‰ï¼š

1. [Scanner](https://v8.dev/blog/scanner)
2. [Preparser and Parser](https://v8.dev/blog/preparser)
3. [Ignition Interpreter](https://v8.dev/docs/ignition)
4. [TurboFan Compiler](https://v8.dev/docs/turbofan)

æµè§ˆå™¨æ˜¯ä»¥ stream çš„å½¢å¼å°† JavaScript ä»£ç äº¤ç»™ V8 å¼•æ“çš„ï¼ŒJS ä»£ç å­—ç¬¦æµä¼šé¦–å…ˆè¿›å…¥ **Scanner**ï¼Œ è¿™æ˜¯ JS ä»£ç è¿›å…¥ V8 å¼•æ“çš„ç¬¬ä¸€é“å…³å£ï¼ŒScanner ä¼šæ¥æ”¶å­—ç¬¦æµå¹¶ç»„åˆå…¶ä¸­è¿ç»­å‡ºç°çš„å­—ç¬¦å°†å…¶è½¬æ¢ä¸ºæœ‰æ„ä¹‰çš„ Tokenã€‚ä¾‹å¦‚ Scanner ä¼šå°†å­—ç¬¦æµä¸­è¿ç»­å‡ºç°çš„ fã€uã€nã€cã€tã€iã€oã€n å­—ç¬¦ç»„åˆä¸º `function`ï¼Œä¼šå°† +ã€+ ç»„åˆä¸º `++`ã€‚
![alt text](image.png)

---

ç¬¬äºŒé“å…³å¡ä¾¿æ˜¯ Preparser å’Œ Parserï¼Œä»–ä»¬çš„ä½œç”¨æ˜¯å°† Scanner è½¬æ¢åçš„ Token ç»§ç»­è½¬æ¢ä¸º ASTï¼Œä¾‹å¦‚ `function` ä¼šå˜ä¸º `FunctionDelcartion`ï¼Œ`const` ä¼šå˜ä¸º `VariableDeclartion`ã€‚
è¿™ä¸€æ­¥å¯ä»¥ä½¿ç”¨ä¸€äº›åœ¨çº¿å·¥å…·ï¼Œä¾‹å¦‚ https://astexplorer.net/ æŸ¥çœ‹å…·ä½“çš„ AST å†…å®¹ã€‚
![alt text](image-3.png)

---

åœ¨ Parser å®Œæˆä¹‹å Ignition Interpreter æ‰èƒ½å°† AST è½¬æ¢ä¸ºå­—èŠ‚ç ï¼Œå¹¶é€è¡Œè§£é‡Šå’Œæ‰§è¡Œï¼Œ ä»¥å¦‚ä¸‹ JavaScript ä»£ç ä¸ºä¾‹ï¼š

```javascript
function plusOne(x) {
  return x + 1
}

plusOne(2) // V8 æ˜¯æƒ°æ€§ç¼–è¯‘çš„ï¼Œå¦‚æœå‡½æ•°ä¸æ‰§è¡Œåˆ™ä¸ä¼šç”Ÿæˆå¯¹åº”çš„å­—èŠ‚ç 
```

æ‰§è¡Œ `node --print-bytecode index.js` å è¯¥å‡½æ•°ä¼šç”Ÿæˆå¦‚ä¸‹çš„å­—èŠ‚ç ï¼š

```shell
[generated bytecode for function: plusOne (0x38e93155b159 <SharedFunctionInfo plusOne>)]
Bytecode length: 6
Parameter count 2
Register count 0
Frame size 0
Bytecode age: 0
   24 S> 0x38e93155bcf6 @    0 : 0b 03             Ldar a0
   33 E> 0x38e93155bcf8 @    2 : 44 01 00          AddSmi [1], [0]
   36 S> 0x38e93155bcfb @    5 : a9                Return
Constant pool (size = 0)
Handler Table (size = 0)
Source Position Table (size = 8)
0x38e93155bd01 <ByteArray[8]>
```

æˆ‘ä»¬èšç„¦åœ¨ Bytecode çš„éƒ¨åˆ†ï¼š

1. ç¬¬ä¸€ä¸ªå­—èŠ‚ç æ˜¯ `Ldar` è¡¨ç¤ºå°† plusOne çš„ç¬¬ 0 ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯ a0 åŠ è½½åˆ°å¯„å­˜å™¨ä¸­
2. ç¬¬äºŒä¸ªå­—èŠ‚ç æ˜¯ `AddSmi` è¡¨ç¤ºå°†å¯„å­˜å™¨ä¸­çš„æ•°åŠ  1
3. æœ€åä¸€ä¸ªå­—èŠ‚ç  `Return` è¡¨ç¤ºè¿”å›å¯„å­˜å™¨ä¸­çš„æ•°ã€‚

å…³äºå­—èŠ‚ç çš„æ›´å¤šä»‹ç»å¯ä»¥é˜…è¯» [Understanding V8â€™s Bytecode](https://medium.com/dailyjs/understanding-v8s-bytecode-317d46c94775)ã€‚

---

TurboFan Compiler çš„ä½œç”¨æ˜¯ä¼˜åŒ– JS ä¸­çš„çƒ­ç‚¹ä»£ç ï¼ŒTurboFan å°†æ‰§è¡Œé¢‘ç‡é«˜çš„å­—èŠ‚ç ç›´æ¥è½¬æ¢ä¸ºæœºå™¨ç è¿è¡Œï¼Œä¹‹å V8 é‡åˆ°ç›¸åŒçš„ä»£ç å¯ä»¥ç”¨ç¼–è¯‘å¥½çš„æœºå™¨ç æ‰§è¡Œï¼ŒåŠ å¿«æ•ˆç‡ã€‚

æ€»çš„æ¥è¯´ï¼ŒV8 é‡‡ç”¨äº†ä¸€ç§æ··åˆç­–ç•¥ï¼šå­—èŠ‚ç ç”± Ignition è§£é‡Šå™¨æ‰§è¡Œï¼Œè€Œæœºå™¨ç åˆ™ç›´æ¥ç”± CPU æ‰§è¡Œã€‚è¿™ç§æ–¹æ³•ç»“åˆäº†è§£é‡Šæ‰§è¡Œçš„çµæ´»æ€§å’Œç¼–è¯‘æ‰§è¡Œçš„é«˜æ€§èƒ½ï¼Œä½¿å¾— JavaScript èƒ½å¤Ÿåœ¨ä¿æŒå…¶åŠ¨æ€ç‰¹æ€§çš„åŒæ—¶ï¼Œä¹Ÿèƒ½è·å¾—æ¥è¿‘åŸç”Ÿä»£ç çš„æ‰§è¡Œæ•ˆç‡ã€‚

#### ç¬¬ä¸‰é—®ï¼šJavaScript å¯¹è±¡åœ¨ V8 ä¸­æ˜¯å¦‚ä½•è¡¨ç¤ºçš„ï¼Ÿ

JavaScript æ˜¯åŠ¨æ€è§£é‡Šå‹è¯­è¨€ï¼Œåœ¨å¯¹è±¡åˆå§‹åŒ–åå¯ä»¥åŠ¨æ€å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹å¯¹è±¡æˆå‘˜å±æ€§ï¼Œè€Œä¸”å¼€å‘è€…å¯ä»¥åƒä½¿ç”¨å­—å…¸ç»“æ„ä¸€æ ·æ¥ä½¿ç”¨ JavaScript å¯¹è±¡ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å–å¾—å¯¹è±¡æˆå‘˜å±æ€§çš„å€¼ã€‚åœ¨ V8 å†…éƒ¨ä¼šå°† JavaScript å¯¹è±¡å±æ€§åˆ†ä¸º**ä¸¤ç§æ¨¡å¼ï¼Œä¸‰ç§ç±»å‹**ã€‚ä¸¤ç§æ¨¡å¼æŒ‡çš„æ˜¯**å¿«å±æ€§å’Œæ…¢å±æ€§**ï¼Œä¸‰ç§ç±»å‹åˆ†åˆ«æ˜¯ `In-Object`ã€`Elements` å’Œ `Properties`ã€‚

åœ¨ç»§ç»­é˜è¿° V8 å†…éƒ¨çš„å±æ€§è¡¨ç¤ºæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆäº†è§£ä¸€ä¸‹ EcmaScript è§„èŒƒä¸­æ˜¯å¦‚ä½•è§„å®šå±æ€§éå†çš„è¡Œä¸ºçš„ã€‚å‡è®¾æœ‰å¦‚ä¸‹ JavaScript å¯¹è±¡ï¼š

```javascript
const obj = {
  foo: "bar",
  baz: "fizz",
  1: "hello",
  3: "!",
  2: "world",
  bar: "ace",
}
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `for in` æˆ–è€… `Object.keys` æ¥éå† obj çš„é”®å€¼ã€‚

```javascript
Object.keys(obj)
// (6)Â ['1', '2', '3', 'foo', 'baz', 'bar']

for (let key in obj) {
  console.log(key)
}
// 1
// 2
// 3
// foo
// baz
// bar
```

æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°çš„ç»“æœæ˜¯æ— è®ºæŒ‰ä½•ç§é¡ºåºå®šä¹‰å¯¹è±¡çš„å±æ€§ï¼Œ**JS å¼•æ“æ€»æ˜¯ä¼˜å…ˆéå†æ•´æ•°æ•°å­—çš„å±æ€§é”®ï¼Œå…¶æ¬¡æ‰ä¼šæŒ‰ç…§å­—ç¬¦ä¸²å±æ€§é”®çš„å®šä¹‰é¡ºåºï¼ˆåˆ›å»ºæ—¶é—´ï¼‰æ¥éå†å…¶ä»–çš„å±æ€§é”®**ã€‚åŸºäºæ­¤é¡¹è§„èŒƒ V8 åœ¨å¼•æ“å†…éƒ¨ä¼šæŒ‰ç…§å¯¹è±¡å±æ€§çš„é”®çš„ç±»å‹æ˜¯å¦ä¸ºæ•´æ•°æ•°å­—å°†å¯¹è±¡å±æ€§åˆ†ä¸ºä¸¤éƒ¨åˆ†åˆ†åˆ«å­˜å‚¨ï¼Œå®ƒä»¬æ˜¯ `Elements` å’Œ `Properties`ã€‚

æ•´æ•°æ•°å­—å±æ€§çš„é”®ä¼šå­˜å‚¨åœ¨ `Elements` ä¸­ï¼Œéæ•´æ•°æ•°å­—çš„é”®ä¼šå­˜å‚¨åœ¨ `Properties` ä¸­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ `Elements` å’Œ `Properties` éƒ½æ˜¯æŒ‰ç…§çº¿æ€§æ•°æ®ç»“æ„ï¼ˆæ•°ç»„ï¼‰å­˜å‚¨çš„ï¼Œä¸»è¦æ˜¯å› ä¸ºçº¿æ€§æ•°æ®ç»“æ„åœ¨å†…å­˜ç®¡ç†å’Œè®¿é—®é€Ÿåº¦ä¸Šä¼šæ›´æœ‰æ•ˆç‡ã€‚

å½“æˆ‘ä»¬é€šè¿‡ `obj[1]` è®¿é—®å±æ€§å€¼çš„æ—¶å€™ï¼ŒV8 å¼•æ“ä¼šä» `obj` å¯¹è±¡çš„ `Elements` ä¸­æŒ‰ç…§æ•°å­—ç´¢å¼•ç›´æ¥è·å–åˆ°å±æ€§å€¼ã€‚ä½†æ˜¯å½“æˆ‘ä»¬é€šè¿‡ `obj['foo']` æ¥è®¿é—®å±æ€§å€¼çš„æ—¶å€™ï¼ŒV8 ä¸èƒ½ç®€å•çš„ä» `Properties` ä¸­å–å¾—å±æ€§å€¼ï¼Œå› ä¸º V8 æ— æ³•å°†éæ•´æ•°æ•°å­—ç±»å‹çš„é”®è½¬æ¢ä¸ºå¯¹åº”çš„ç´¢å¼•å€¼ï¼Œä¹Ÿå°±æ— æ³•çŸ¥é“å¯¹åº”çš„å€¼æ˜¯æ”¾åœ¨ `Properties` ä¸­çš„å“ªä¸ªä½ç½®äº†ï¼Œæ­¤æ—¶å°±å¼•å…¥äº† Hidden Class éšè—ç±»çš„æ¦‚å¿µã€‚

![alt text](image-5.png)

éšè—ç±»åŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ª Map å®ƒå­˜å‚¨äº†éæ•´æ•°æ•°å­—å¯¹è±¡å±æ€§é”®åŠå…¶åœ¨ `Properties` ä¸­çš„åç§»é‡ã€‚å¦‚æœä½ æœ‰é™æ€è¯­è¨€çš„ç¼–ç¨‹ç»éªŒä½ å°±ä¼šçŸ¥é“ï¼Œåœ¨ C++ã€Javaã€Rust ç­‰é™æ€è¯­è¨€ä¸­è¦æƒ³åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå°±å¿…é¡»æœ‰ç»“æ„ä½“æˆ–è€…ç±»ã€‚éšè—ç±»åœ¨ V8 ä¸­å°±èµ·åˆ°è¿™ä¸ªä½œç”¨ï¼Œå®ƒèƒ½è®©å¼•æ“çŸ¥é“è¿™ä¸ªå¯¹è±¡çš„ç»“æ„å…·ä½“æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œè€Œä¸”è¿™ä¸ªç»“æ„åœ¨ V8 ä¸­æ˜¯å¯ä»¥è·¨å¯¹è±¡å…±äº«çš„ï¼ˆéšè—ç±»çš„å…±äº«å¿…é¡»è¦æ±‚æ˜¯ç›¸åŒçš„å±æ€§å’Œç›¸åŒçš„é¡ºåºæ‰å¯ä»¥å…±äº«ï¼‰ã€‚

æˆ‘ä»¬å¯ä»¥å‚è€ƒä¸Šé¢çš„å›¾ä¾‹æ¥ç®€å•çš„ç†è§£éšè—ç±»ï¼Œå½“æˆ‘ä»¬é€šè¿‡ `obj['foo']` æ¥è®¿é—®å±æ€§å€¼çš„æ—¶å€™ï¼ŒV8 é¦–å…ˆä»éšè—ç±»ä¸­å–å¾— `foo` å±æ€§åœ¨ `Properties` ä¸­ç›¸å¯¹åº”çš„åç§»é‡ï¼Œç„¶åæ‰èƒ½æŒ‰ç…§è¿™ä¸ªåç§»é‡ä» `Properties` ä¸­å–å¾—å¯¹åº”çš„å±æ€§å€¼ã€‚

éšè—ç±»åœ¨å¯¹è±¡åˆå§‹åŒ–å’Œæ¯æ¬¡å¯¹è±¡å±æ€§æ”¹å˜çš„æ—¶å€™éƒ½ä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼ŒV8 è¿˜æœ‰å•ç‹¬çš„ `TransitionArray` æ¥ç®¡ç†éšè—ç±»çš„è¿‡æ¸¡ã€‚åˆ°æ­¤ä¸ºæ­¢æˆ‘ä»¬å·²ç»äº†è§£åˆ°äº† V8 å†…éƒ¨çš„ä¸¤ç§å±æ€§åˆ†ç±» `Elements` å’Œ `Properties`ï¼Œé‚£å‰é¢è¯´çš„å¿«æ…¢å±æ€§å’Œ `In-Object` å±æ€§åˆ†ç±»åˆæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ

æˆ‘ä»¬å·²ç»çŸ¥é“é€šè¿‡ `obj['foo']` æ¥è®¿é—®å±æ€§å€¼çš„æ—¶å€™ï¼Œè¦å…ˆè®¿é—®éšè—ç±»è·å–åç§»é‡ï¼Œå†è®¿é—® `Properties` å–å¾—å…·ä½“å±æ€§å€¼ï¼Œè¿™ä¸­é—´æœ‰ä¸‰æ¬¡å¯»å€è¿‡ç¨‹ï¼š

- è®¿é—®éšè—ç±»
- è®¿é—®`Properties`
- è®¿é—®å…·ä½“å±æ€§ï¼ˆåœ¨ `Properties` å†…éƒ¨ï¼‰

`In-Object` å…¶å®æ˜¯ V8 çš„ä¸€é¡¹å†…éƒ¨ä¼˜åŒ–ï¼ŒV8 ä¼šç‰¹æ„æŒ‘é€‰ä¸€äº›å±æ€§å°†å…¶ç›´æ¥å­˜æ”¾åœ¨å¯¹è±¡ä¸­ï¼Œè€Œä¸æ˜¯å¯¹è±¡çš„`Properties`ä¸­ï¼Œè¿™æ ·åœ¨é€šè¿‡ `obj['foo']` æ¥è®¿é—®å±æ€§å€¼çš„æ—¶å€™ï¼Œå°±èƒ½èŠ‚çœä¸€æ­¥å¯»å€çš„è¿‡ç¨‹ã€‚

- è®¿é—®éšè—ç±»
- è®¿é—®å…·ä½“å±æ€§ï¼ˆåœ¨å¯¹è±¡å†…éƒ¨ï¼‰

![alt text](image-6.png)

ä½†æ˜¯ `In-object` å±æ€§çš„æ•°é‡ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œå…·ä½“çš„å¤§å°å–å†³ä¸ JS å¯¹è±¡çš„å¤§å°ï¼Œå½“å¯¹è±¡å†…éƒ¨å­˜æ”¾ä¸ä¸‹çš„æ—¶å€™ï¼Œå±æ€§è¿˜æ˜¯ä¼šè¢«æ”¾å›åˆ° `Properties` ä¸­ã€‚

å¿«å±æ€§å’Œæ…¢å±æ€§æŒ‡çš„æ˜¯ `Elements` å’Œ `Properties` ä½¿ç”¨çš„æ•°æ®ç»“æ„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä»–ä»¬éƒ½é‡‡ç”¨çº¿æ€§ç»“æ„å­˜å‚¨ï¼Œä½†æ˜¯å½“ JS å¯¹è±¡å¤ªå¤æ‚æˆ–è€…å±æ€§å˜åŒ–è¿‡å¤šçš„æ—¶å€™ï¼ŒV8 ä¼šä½¿ç”¨åŸºäºå­—å…¸çš„éçº¿æ€§æ•°æ®ç»“æ„ä½œä¸º `Elements` å’Œ `Properties` çš„å­˜å‚¨æ–¹å¼ï¼Œæ­¤æ—¶ç”±äºå­˜å‚¨çš„æ•°æ®ç»“æ„å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆè®¿é—® JS å¯¹è±¡å±æ€§çš„é€Ÿåº¦ä¹Ÿä¼šæ”¹å˜ã€‚

å¿«å±æ€§æŒ‡çš„æ˜¯ä½¿ç”¨çº¿æ€§ç»“æ„å‚¨å­˜çš„å±æ€§ï¼Œåœ¨å¿«å±æ€§ä¸­ `In-Object` å±æ€§çš„è®¿é—®é€Ÿåº¦æ˜¯æœ€å¿«çš„ï¼Œæ…¢å±æ€§æŒ‡çš„æ˜¯ JS å¯¹è±¡å˜å¤æ‚åä½¿ç”¨çš„éçº¿æ€§æ•°æ®ç»“æ„å­˜å‚¨çš„å±æ€§ã€‚

å¦‚æœä½ æƒ³æ›´æ·±å…¥çš„äº†è§£è¿™éƒ¨åˆ†å†…å®¹ï¼Œä½ å¯ä»¥æŸ¥çœ‹ https://v8.dev/blog/fast-properties

åŸºäºéšè—ç±» V8 è¿˜å®ç°äº†å†…è”ç¼“å­˜ï¼ˆInline Cachesï¼‰çš„æœºåˆ¶ï¼Œè¯¥æœºåˆ¶çš„ä¸»è¦åŸç†æ˜¯ç¼“å­˜å­—èŠ‚ç å…³äºå±æ€§è®¿é—®ã€å‡½æ•°è°ƒç”¨çš„è°ƒç”¨ç‚¹ï¼ˆCallSiteï¼‰ä¿¡æ¯ï¼Œå› ä¸ºç›¸åŒéšè—ç±»çš„å¯¹è±¡å®ƒçš„å±æ€§è®¿é—®æ–¹å¼ä¸€å®šçš„ç›¸åŒçš„ã€‚å¦‚æœä½ æƒ³æ›´è¯¦ç»†çš„äº†è§£å†…è”ç¼“å­˜ä½ å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š https://mathiasbynens.be/notes/shapes-ics

#### ç¬¬å››é—®ï¼šå¦‚ä½•ç¼–å†™å¯¹ V8 æ€§èƒ½å‹å¥½çš„ JavaScript ä»£ç å‘¢ï¼Ÿ

1. åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–æ‰€æœ‰æˆå‘˜ï¼Œè¿™æœ‰åŠ©äº V8 å¼•æ“æ­£ç¡®åœ°ç†è§£å¯¹è±¡çš„éšè—ç±»ï¼Œä»è€Œç”Ÿæˆæ›´é«˜æ•ˆçš„ä»£ç ã€‚
2. å§‹ç»ˆä»¥ç›¸åŒçš„é¡ºåºåˆå§‹åŒ–å¯¹è±¡æˆå‘˜ï¼Œä»¥ç¡®ä¿å¯¹è±¡å…·æœ‰ç›¸åŒçš„éšè—ç±»ï¼Œè¿™æœ‰åŠ©äº V8 å¼•æ“å¤ç”¨ä¼˜åŒ–ä»£ç ã€‚
3. å°½å¯èƒ½ä½¿ç”¨ 31 ä½æœ‰ç¬¦å·æ•´æ•°ï¼ˆsmiï¼‰ï¼Œå› ä¸º V8 å†…éƒ¨å¯¹ smi æœ‰ç‰¹åˆ«çš„ä¼˜åŒ–å¤„ç†ã€‚
4. é¿å…åœ¨æ•°å€¼æ•°ç»„ä¸­å­˜å‚¨éæ•°å€¼ç±»å‹çš„å€¼ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´ V8 å¼•æ“åœ¨å¤„ç†æ•°ç»„æ—¶è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå½±å“æ€§èƒ½ã€‚
5. ä½¿ç”¨æ•°ç»„å­—é¢é‡åˆå§‹åŒ–å°æ•°ç»„ï¼ˆå°‘äº 65000 ä¸ªå…ƒç´ çš„æ•°ç»„ï¼‰ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„æ•°ç»„æ ¼å¼è½¬æ¢å’Œå†…å­˜åˆ†é…ã€‚
6. ä¸è¦åˆ é™¤æ•°ç»„å…ƒç´ ï¼Œè¿™æ ·å¯ä»¥ä¿æŒæ•°ç»„çš„ç´§å‡‘å­˜å‚¨æ ¼å¼ï¼Œé¿å…é€€åŒ–åˆ°å­—å…¸å­˜å‚¨æ–¹å¼ï¼Œä»è€Œä¿æŒå¿«é€Ÿè®¿é—®ã€‚
7. é¿å…åœ¨æ•°ç»„ä¸­ä½¿ç”¨éè¿ç»­çš„ç´¢å¼•ï¼Œä»¥å… V8 å°†æ•°ç»„å­˜å‚¨æ–¹å¼ä»å¿«å±æ€§è½¬å˜ä¸ºæ…¢å±æ€§ã€‚
8. åœ¨æ€§èƒ½æ•æ„Ÿçš„ä»£ç ä¸­é¿å…ä½¿ç”¨ try-catch å—ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šé˜»æ­¢ V8 çš„ä¼˜åŒ–ç¼–è¯‘å™¨å¯¹è¯¥ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚å¦‚æœéœ€è¦ä½¿ç”¨ try-catchï¼Œåº”è¯¥å°†æ€§èƒ½æ•æ„Ÿçš„æ“ä½œå°è£…åœ¨å•ç‹¬çš„å‡½æ•°ä¸­ã€‚
9. é¿å…åœ¨å·²ä¼˜åŒ–çš„å‡½æ•°ä¸­å¼•å…¥æ–°çš„éšè—ç±»å˜åŒ–ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ V8 æ‰§è¡Œ â€œé€€ä¼˜åŒ–â€ï¼ˆdeoptimizationï¼‰ï¼Œä»è€Œé™ä½æ€§èƒ½ã€‚
10. å°½é‡ç¼–å†™å•æ€ï¼ˆmonomorphicï¼‰ä»£ç ï¼Œå³ä»£ç åœ¨æ‰§è¡Œæ—¶æ€»æ˜¯å¤„ç†ç›¸åŒç±»å‹çš„å¯¹è±¡ï¼Œè¿™æ · V8 å¯ä»¥ç”Ÿæˆæ›´é«˜æ•ˆçš„ specialized codeã€‚
11. é¿å…åœ¨ä¼˜åŒ–ä»£ç ä¸­å¼•å…¥å¤šæ€ï¼ˆpolymorphicï¼‰æ“ä½œï¼Œå› ä¸ºå¤šæ€æ“ä½œä¼šå¯¼è‡´ V8 ç”Ÿæˆè¾ƒæ…¢çš„ä»£ç ã€‚

æ›´è¯¦ç»†çš„æ³¨æ„äº‹é¡¹å¯ä»¥æŸ¥çœ‹è¿™ä¸ªè§†é¢‘ï¼šhttps://www.youtube.com/watch?v=UJPdhx5zTaw&t=897s

#### ç¬¬äº”é—®ï¼šé™¤äº† V8 ä¹‹å¤–è¿˜æœ‰å…¶ä»–çš„ JavaScript å¼•æ“å—ï¼Ÿ

é™¤äº† Google å¼€å‘çš„ V8 å¼•æ“ä¹‹å¤–ï¼Œè¿˜æœ‰ Apple å¼€å‘çš„ [JavaScript Core](https://developer.apple.com/documentation/javascriptcore) å¼•æ“ï¼ŒJavaScript Core æ˜¯ Webkit æ¸²æŸ“å¼•æ“çš„ä¸€éƒ¨åˆ†ï¼ŒWebkit æ¸²æŸ“å¼•æ“ç”± WebCore å’Œ JavaScript Core ç»„æˆï¼ŒWebCore è´Ÿè´£è§£æå’Œæ¸²æŸ“ HTMLã€CSS ç­‰å†…å®¹ï¼ŒJavaScript Core è´Ÿè´£è§£æ JavaScript ä»£ç ã€‚Webkit æ˜¯ Safari æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“ï¼Œå¹¶ä¸”æ˜¯ iOS ç³»ç»Ÿä¸Šå”¯ä¸€å…è®¸çš„æ¸²æŸ“å¼•æ“ï¼ˆå³æ‰€æœ‰ iOS ä¸Šçš„æµè§ˆå™¨ï¼Œå¦‚ Chrome å’Œ Firefoxï¼Œä¹Ÿå¿…é¡»ä½¿ç”¨ WebKitï¼‰ã€‚

> Blink æ¸²æŸ“å¼•æ“æ˜¯ Google åŸºäº Webkit å¼€å‘çš„ï¼ŒWebkit ä¸»è¦æœåŠ¡äº Apple ç”Ÿæ€ï¼Œè€Œ Blink æ”¯æŒæ‰€æœ‰åŸºäº Chromium ç³»çš„æµè§ˆå™¨ã€‚

[Bun](https://bun.sh/) æ˜¯ä¸€ä¸ªæ–°çš„ JavaScript è¿è¡Œæ—¶ï¼Œå®ƒä½¿ç”¨ Zig è¯­è¨€å¼€å‘ï¼Œå®ƒæ‰©å±•äº† JavaScript Core ä½œä¸ºå…¶è¿è¡Œæ—¶çš„å¼•æ“ã€‚

#### å‚è€ƒèµ„æ–™ï¼š

1. https://v8.dev/docs
2. https://www.alibabacloud.com/blog/javascript-bytecode-v8-ignition-instructions_599188
3. https://medium.com/dailyjs/understanding-v8s-bytecode-317d46c94775
4. https://www.youtube.com/watch?v=xckH5s3UuX4
5. https://deepu.tech/memory-management-in-v8/
